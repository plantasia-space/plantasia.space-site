async function loginUser(email,password){try{const response=await fetch("https://media.maar.world:443/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:email,password:password})});if(!response.ok){const errorData=await response.json();throw new Error(errorData.message||"Login failed. Please try again.")}const data=await response.json();if(console.log("Login response:",data),!data.userId)throw new Error("Login response does not contain userId.");localStorage.setItem("userId",data.userId),console.log("UserId set to localStorage:",data.userId),window.location.href="/voyage"}catch(error){console.error("Login error:",error);const messageElement=document.getElementById("message");messageElement&&(messageElement.innerText=error.message,messageElement.style.color="red")}}async function initializeAuth(){try{if(isPublicPage)return void console.log("Public page detected. No authentication required.");const existingUserId=localStorage.getItem("userId");if(existingUserId)return void console.log("UserId already in localStorage:",existingUserId);const response=await fetch("https://media.maar.world:443/api/auth/check-session",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),data=await response.json();if(response.ok&&data.user){const userId=data.user.id;localStorage.setItem("userId",userId),console.log("Authenticated user added to localStorage:",userId),"/login"===window.location.pathname&&(window.location.href="/voyage")}else console.warn("Session invalid. Clearing userId."),localStorage.removeItem("userId"),"/login"!==window.location.pathname&&(window.location.href="/login")}catch(error){console.error("Error during authentication:",error),"/login"!==window.location.pathname&&(window.location.href="/login")}}async function forgotPassword(email){try{const response=await fetch("https://media.maar.world:443/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:email})});if(!response.ok){const errorData=await response.json();throw new Error(errorData.message||"Password reset failed")}console.log("Password reset email sent to:",email);const messageElement=document.getElementById("message");messageElement&&(messageElement.innerText="Password reset email sent! Please check your inbox.",messageElement.style.color="green")}catch(error){console.error("Password reset error:",error);const messageElement=document.getElementById("message");messageElement&&(messageElement.innerText="Password reset failed. Please try again.",messageElement.style.color="red")}}async function checkAuth(){try{const response=await fetch("https://media.maar.world:443/api/auth/check-session",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(response.ok){return null!==(await response.json()).user}return console.warn("Session check failed:",response.status),!1}catch(error){return console.error("Error during authentication check:",error),!1}}async function logoutUser(){try{if(!(await fetch("https://media.maar.world:443/api/auth/logout",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Logout failed");localStorage.clear(),updateAuthLink(!1),window.location.href="/login"}catch(error){console.error("Logout error:",error),alert("Logout failed. Please try again.")}}function updateAuthLink(isLoggedIn){console.log("updateAuthLink called with isLoggedIn:",isLoggedIn);const authLink=document.getElementById("auth-link");authLink?(console.log("Auth link element found. Updating..."),isLoggedIn?(authLink.innerHTML='<span class="material-symbols-outlined">logout</span> Logout',authLink.onclick=event=>{event.preventDefault(),logoutUser()},authLink.href="#"):(authLink.innerHTML='<span class="material-symbols-outlined">login</span> Login',authLink.onclick=null,authLink.href="/login")):console.error("Auth link element not found!")}document.addEventListener("DOMContentLoaded",initializeAuth),window.loginUser=loginUser,window.logoutUser=logoutUser,window.forgotPassword=forgotPassword,window.checkAuth=checkAuth;