async function handleCollapsibleSections(){document.querySelectorAll(".collapsible-section").forEach((section=>{const header=section.querySelector(".section-header"),toggleButton=section.querySelector(".toggle-button"),content=section.querySelector(".section-content"),icon=toggleButton.querySelector(".toggle-icon"),sectionId=section.getAttribute("data-section-id");if(!sectionId)return void console.warn("Collapsible section missing data-section-id:",section);const savedState=localStorage.getItem(`collapsible_${sectionId}`);let isExpanded;null!==savedState?(isExpanded="true"===savedState,console.log(`Section "${sectionId}" retrieved from localStorage as: ${isExpanded}`)):(isExpanded="dashboard-menu"===sectionId,console.log(`Section "${sectionId}" set to default state: ${isExpanded}`)),toggleButton.setAttribute("aria-expanded",isExpanded),header.setAttribute("aria-expanded",isExpanded),section.classList.toggle("collapsed",!isExpanded),icon.textContent=isExpanded?"keyboard_arrow_up":"keyboard_arrow_down",content.style.height=isExpanded?"auto":"0px";const toggleSection=()=>{const newExpandedState=!("true"===toggleButton.getAttribute("aria-expanded"));if(toggleButton.setAttribute("aria-expanded",newExpandedState),header.setAttribute("aria-expanded",newExpandedState),section.classList.toggle("collapsed",!newExpandedState),icon.textContent=newExpandedState?"keyboard_arrow_up":"keyboard_arrow_down",newExpandedState){const contentHeight=content.scrollHeight;content.style.height=`${contentHeight}px`,content.addEventListener("transitionend",(function handleTransitionEnd(){content.style.height="auto",content.removeEventListener("transitionend",handleTransitionEnd)}))}else{const contentHeight=content.scrollHeight;content.style.height=`${contentHeight}px`,content.offsetHeight,content.style.height="0"}localStorage.setItem(`collapsible_${sectionId}`,newExpandedState),console.log(`Section "${sectionId}" state saved as: ${newExpandedState}`)};header.addEventListener("click",(function(e){e.target.closest(".toggle-button")||toggleSection()})),toggleButton.addEventListener("click",(function(e){e.stopPropagation(),toggleSection()})),header.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),toggleSection())}))}))}async function recalculateMaxHeight(){const expandedSections=document.querySelectorAll(".collapsible-section[data-section-id]:not(.collapsed)");for(const section of expandedSections){const content=section.querySelector(".section-content");if(content){const images=content.querySelectorAll("img");await Promise.all(Array.from(images).map((img=>img.complete&&0!==img.naturalHeight?Promise.resolve():new Promise((resolve=>{img.onload=resolve,img.onerror=resolve}))))),content.style.maxHeight=`${content.scrollHeight}px`,console.log(`Recalculated max-height for section "${section.getAttribute("data-section-id")}" to ${content.scrollHeight}px`)}}}async function handleFormCollapsibleSections(){document.querySelectorAll(".collapsible-section.form-collapsible").forEach((section=>{const header=section.querySelector(".section-header"),toggleButton=section.querySelector(".toggle-button"),content=section.querySelector(".section-content"),icon=toggleButton.querySelector(".toggle-icon"),sectionId=section.getAttribute("data-section-id");if(!sectionId)return void console.warn("Form collapsible section missing data-section-id:",section);const savedState=localStorage.getItem(`collapsible_${sectionId}`);let isExpanded;null!==savedState?(isExpanded="true"===savedState,console.log(`Form Section "${sectionId}" retrieved from localStorage as: ${isExpanded}`)):(isExpanded=!0,console.log(`Form Section "${sectionId}" set to default state: ${isExpanded}`)),toggleButton.setAttribute("aria-expanded",isExpanded),header.setAttribute("aria-expanded",isExpanded),section.classList.toggle("collapsed",!isExpanded),icon.textContent=isExpanded?"keyboard_arrow_up":"keyboard_arrow_down",content.style.height=isExpanded?"auto":"0px";const toggleSection=()=>{const newExpandedState=!("true"===toggleButton.getAttribute("aria-expanded"));if(toggleButton.setAttribute("aria-expanded",newExpandedState),header.setAttribute("aria-expanded",newExpandedState),section.classList.toggle("collapsed",!newExpandedState),icon.textContent=newExpandedState?"keyboard_arrow_up":"keyboard_arrow_down",newExpandedState){content.style.display="block";const contentHeight=content.scrollHeight;content.style.height=`${contentHeight}px`,content.addEventListener("transitionend",(function handleTransitionEnd(){content.style.height="auto",content.removeEventListener("transitionend",handleTransitionEnd)}))}else{const contentHeight=content.scrollHeight;content.style.height=`${contentHeight}px`,content.offsetHeight,content.style.height="0"}localStorage.setItem(`collapsible_${sectionId}`,newExpandedState),console.log(`Form Section "${sectionId}" state saved as: ${newExpandedState}`)};header.addEventListener("click",(function(e){e.target.closest(".toggle-button")||toggleSection()})),toggleButton.addEventListener("click",(function(e){e.stopPropagation(),toggleSection()})),header.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),toggleSection())}))}))}async function recalculateFormMaxHeight(){const expandedSections=document.querySelectorAll(".collapsible-section.form-collapsible:not(.collapsed)");for(const section of expandedSections){const content=section.querySelector(".section-content");if(content){const images=content.querySelectorAll("img");await Promise.all(Array.from(images).map((img=>img.complete&&0!==img.naturalHeight?Promise.resolve():new Promise((resolve=>{img.onload=resolve,img.onerror=resolve}))))),content.style.maxHeight=`${content.scrollHeight}px`,console.log(`Recalculated max-height for form section "${section.getAttribute("data-section-id")}" to ${content.scrollHeight}px`)}}}function observeFormCollapsibleChanges(){document.querySelectorAll(".collapsible-section.form-collapsible").forEach((section=>{const content=section.querySelector(".section-content");if(!content)return;new MutationObserver((()=>{section.classList.contains("collapsed")||window.recalculateFormMaxHeight()})).observe(content,{childList:!0,subtree:!0,attributes:!0,characterData:!0})}))}async function initializeFormCollapsibles(){await handleFormCollapsibleSections(),await recalculateFormMaxHeight(),observeFormCollapsibleChanges()}async function handleCollapsibleSections(){document.querySelectorAll(".collapsible-section").forEach((section=>{const header=section.querySelector(".section-header"),toggleButton=section.querySelector(".toggle-button"),content=section.querySelector(".section-content"),icon=toggleButton.querySelector(".toggle-icon"),sectionId=section.getAttribute("data-section-id");if(!sectionId)return void console.warn("Collapsible section missing data-section-id:",section);const savedState=localStorage.getItem(`collapsible_${sectionId}`);let isExpanded;null!==savedState?(isExpanded="true"===savedState,console.log(`Section "${sectionId}" retrieved from localStorage as: ${isExpanded}`)):(isExpanded="dashboard-menu"===sectionId,console.log(`Section "${sectionId}" set to default state: ${isExpanded}`)),toggleButton.setAttribute("aria-expanded",isExpanded),header.setAttribute("aria-expanded",isExpanded),section.classList.toggle("collapsed",!isExpanded),icon.textContent=isExpanded?"keyboard_arrow_up":"keyboard_arrow_down",content.style.height=isExpanded?"auto":"0px";const toggleSection=()=>{const newExpandedState=!("true"===toggleButton.getAttribute("aria-expanded"));if(toggleButton.setAttribute("aria-expanded",newExpandedState),header.setAttribute("aria-expanded",newExpandedState),section.classList.toggle("collapsed",!newExpandedState),icon.textContent=newExpandedState?"keyboard_arrow_up":"keyboard_arrow_down",newExpandedState){const contentHeight=content.scrollHeight;content.style.height=`${contentHeight}px`,content.addEventListener("transitionend",(function handleTransitionEnd(){content.style.height="auto",content.removeEventListener("transitionend",handleTransitionEnd)}))}else{const contentHeight=content.scrollHeight;content.style.height=`${contentHeight}px`,content.offsetHeight,content.style.height="0"}localStorage.setItem(`collapsible_${sectionId}`,newExpandedState),console.log(`Section "${sectionId}" state saved as: ${newExpandedState}`)};header.addEventListener("click",(function(e){e.target.closest(".toggle-button")||toggleSection()})),toggleButton.addEventListener("click",(function(e){e.stopPropagation(),toggleSection()})),header.addEventListener("keydown",(function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),toggleSection())}))}))}async function recalculateMaxHeight(){const expandedSections=document.querySelectorAll(".collapsible-section[data-section-id]:not(.collapsed)");for(const section of expandedSections){const content=section.querySelector(".section-content");if(content){const images=content.querySelectorAll("img");await Promise.all(Array.from(images).map((img=>img.complete&&0!==img.naturalHeight?Promise.resolve():new Promise((resolve=>{img.onload=resolve,img.onerror=resolve}))))),content.style.maxHeight=`${content.scrollHeight}px`,console.log(`Recalculated max-height for section "${section.getAttribute("data-section-id")}" to ${content.scrollHeight}px`)}}}window.handleCollapsibleSections=handleCollapsibleSections,window.recalculateMaxHeight=recalculateMaxHeight,window.handleFormCollapsibleSections=handleFormCollapsibleSections,window.recalculateFormMaxHeight=recalculateFormMaxHeight;