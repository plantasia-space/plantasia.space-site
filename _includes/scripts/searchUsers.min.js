!function(){const API_ENDPOINT="https://media.maar.world:443/api/users/searchUsers";function debounce(func,delay){let timeout;return function(...args){clearTimeout(timeout),timeout=setTimeout((()=>func.apply(this,args)),delay)}}function initializeSearchUsers(){document.querySelectorAll(".user-search-input").forEach((input=>{if(input.dataset.initialized)return;input.dataset.initialized="true";const wrapper=input.closest(".input-wrapper"),dropdown=wrapper.querySelector(".dropdown");if(!dropdown)return;let hiddenInput=wrapper.querySelector(".artistUserId");hiddenInput||(hiddenInput=document.createElement("input"),hiddenInput.type="hidden",hiddenInput.classList.add("artistUserId"),hiddenInput.name="artistUserIds[]",wrapper.appendChild(hiddenInput));const debouncedHandleInput=debounce(handleInput,300);input.addEventListener("input",debouncedHandleInput),input.addEventListener("keydown",handleKeyDown),input.addEventListener("blur",handleBlur),document.addEventListener("click",(function(event){wrapper.contains(event.target)||dropdown.classList.remove("active")}))}))}async function handleInput(event){const input=event.target,query=input.value.trim();if(console.log(`Searching for users with query: "${query}"`),query.length<2)!function(input){const wrapper=input.closest(".input-wrapper"),dropdown=wrapper.querySelector(".dropdown");dropdown.innerHTML="",dropdown.classList.remove("active");const hiddenInput=wrapper.querySelector(".artistUserId");hiddenInput&&(hiddenInput.value="")}(input);else try{const response=await fetch(`${API_ENDPOINT}?query=${encodeURIComponent(query)}`);if(console.log(`API Response Status: ${response.status}`),429===response.status)return void showDropdownMessage(input,"Too many requests. Please wait.","error");if(404===response.status)return void showNoUsersFound(input);if(!response.ok)return void showDropdownMessage(input,"Error fetching results.","error");const data=await response.json();console.log("API Response Data:",data),Array.isArray(data)&&data.length>0?function(input,users){const wrapper=input.closest(".input-wrapper"),dropdown=wrapper.querySelector(".dropdown");dropdown.innerHTML="",users.forEach((user=>{const item=document.createElement("div");item.classList.add("dropdown-item"),item.textContent=`${user.displayName} (@${user.username})`,item.dataset.userId=user.userId,item.addEventListener("click",(()=>{input.value=user.username;wrapper.querySelector(".artistUserId").value=user.userId,dropdown.classList.remove("active")})),dropdown.appendChild(item)})),dropdown.classList.add("active")}(input,data):showNoUsersFound(input)}catch(error){console.error("Error fetching user search results:",error),showDropdownMessage(input,"Error fetching results.","error")}}function showDropdownMessage(input,message,type){const dropdown=input.closest(".input-wrapper").querySelector(".dropdown");dropdown.innerHTML="";const messageItem=document.createElement("div");messageItem.classList.add("dropdown-item",`dropdown-item-${type}`),messageItem.textContent=message,dropdown.appendChild(messageItem),dropdown.classList.add("active")}function showNoUsersFound(input){const dropdown=input.closest(".input-wrapper").querySelector(".dropdown");dropdown.innerHTML="";const noResultItem=document.createElement("div");noResultItem.classList.add("dropdown-item","dropdown-item-info"),noResultItem.textContent="No users found. Invite them to join for better collaboration!",dropdown.appendChild(noResultItem);const inviteButton=document.createElement("button");inviteButton.classList.add("invite-button"),inviteButton.textContent="Register a new xPlorer",inviteButton.addEventListener("click",(()=>{window.location.href="/register"})),dropdown.appendChild(inviteButton),dropdown.classList.add("active")}function handleKeyDown(event){const dropdown=event.target.closest(".input-wrapper").querySelector(".dropdown"),items=dropdown.querySelectorAll(".dropdown-item");if(!dropdown.classList.contains("active")||0===items.length)return;let currentIndex=Array.from(items).findIndex((item=>item.classList.contains("active-item")));switch(event.key){case"ArrowDown":event.preventDefault(),currentIndex<items.length-1&&(currentIndex>=0&&items[currentIndex].classList.remove("active-item"),items[currentIndex+1].classList.add("active-item"));break;case"ArrowUp":event.preventDefault(),currentIndex>0&&(items[currentIndex].classList.remove("active-item"),items[currentIndex-1].classList.add("active-item"));break;case"Enter":event.preventDefault(),currentIndex>=0&&items[currentIndex]&&items[currentIndex].click()}}function handleBlur(event){const input=event.target,wrapper=input.closest(".input-wrapper"),hiddenInput=wrapper.querySelector(".artistUserId"),dropdown=wrapper.querySelector(".dropdown");setTimeout((()=>{hiddenInput.value||(input.value="",dropdown.classList.remove("active"))}),200)}window.initializeSearchUsers=initializeSearchUsers,window.debounce=debounce,document.addEventListener("DOMContentLoaded",initializeSearchUsers)}();